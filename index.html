<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Resources</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .custom-file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .upload-button {
            display: none; /* Hide initially */
            margin-top: 10px;
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .upload-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* Style for preview area */
        .file-item {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }

        .file-item span {
            margin-right: 10px;
        }

        .delete-btn {
            cursor: pointer;
            background: none;
            border: none;
            color: red;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <input type="search" id="siteSearch" placeholder="Search resources..." onkeyup="searchSite()">
        <div class="search-padding"></div>
        <a href="#documents" class="active">Documents</a>
        <a href="#websites">Websites</a>
        <a href="#emails">Emails</a>
        <div class="quick-script">
            <p>PATIENT VERIFIED NAME, DOB, SSN, AND ALL OTHER DEMO INFO. INSURANCE IS ?. PCP IS DR. ?.</p>
            <button onclick="copyScript()">Copy Script</button>
        </div>
    </div>

    <div class="main-content">
        <!-- Section for Document Uploads -->
        <section id="documents" class="content-section">
            <h2>Training Documents</h2>
            <div class="container">
                <!-- Custom file input style -->
                <label for="fileInput" class="file-label">Choose File(s)</label>
                <input type="file" id="fileInput" class="custom-file-input" accept=".pdf, .jpg, .jpeg" multiple onchange="handleFileSelect()">

                <!-- Upload button, hidden until a file is selected -->
                <button id="uploadButton" class="upload-button" onclick="uploadFile()">Upload</button>

                <!-- Area to display uploaded files -->
                <div id="previewArea"></div>
            </div>
        </section>

        <!-- Websites Section -->
        <section id="websites" class="content-section" style="display:none;">
            <h2>Useful Websites</h2>
            <div class="container">
                <ul>
                    <li><a href="https://pennstatehealth.provider.ci.healthpay24.cloud/healthcare/search/" target="_blank">HealthPay24</a></li>
                </ul>
            </div>
        </section>

        <!-- Emails Section -->
        <section id="emails" class="content-section" style="display:none;">
            <h2>Email Templates</h2>
            <div class="container">
                <!-- Content for emails -->
            </div>
        </section>
    </div>

    <!-- Firebase SDKs and Configuration -->
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getStorage, ref, uploadBytes, deleteObject } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD1BsRh0vxSHP6MRRStcPBFVdFxAykj_qY",
            authDomain: "information-7efaf.firebaseapp.com",
            projectId: "information-7efaf",
            storageBucket: "information-7efaf.appspot.com",
            messagingSenderId: "501827051484",
            appId: "1:501827051484:web:cead873c48843d99823919"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Show upload button and preview selected files
        function handleFileSelect() {
            const fileInput = document.getElementById('fileInput');
            const uploadButton = document.getElementById('uploadButton');
            const previewArea = document.getElementById('previewArea');

            // Show the upload button only if files are selected
            if (fileInput.files.length > 0) {
                uploadButton.style.display = 'inline-block';
            } else {
                uploadButton.style.display = 'none';
            }

            // Display file names in the preview area
            previewArea.innerHTML = ''; // Clear previous preview
            for (let file of fileInput.files) {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `<span>${file.name}</span>`;
                previewArea.appendChild(fileItem);
            }
        }

        // Function to handle file upload
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            const previewArea = document.getElementById('previewArea');

            for (let file of files) {
                const storageRef = ref(storage, 'uploads/' + file.name);

                try {
                    // Upload the file
                    await uploadBytes(storageRef, file);

                    // Display uploaded file with delete option
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <span>${file.name}</span>
                        <button class="delete-btn" onclick="deleteFile('${file.name}')">üóëÔ∏è</button>
                    `;
                    previewArea.appendChild(fileItem);

                    // Show confirmation message for each file
                    alert(`${file.name} uploaded successfully!`);
                    
                } catch (error) {
                    console.error("Error uploading file:", error);
                    alert(`Failed to upload ${file.name}`);
                }
            }

            // Reset file input and hide upload button
            fileInput.value = "";
            document.getElementById('uploadButton').style.display = 'none';
        }

        // Function to delete a file
        async function deleteFile(fileName) {
            const confirmDelete = confirm(`Are you sure you want to delete ${fileName}?`);
            if (confirmDelete) {
                const storageRef = ref(storage, 'uploads/' + fileName);
                try {
                    await deleteObject(storageRef);
                    alert(`${fileName} has been deleted successfully!`);
                    
                    // Remove the file item from the preview area
                    const previewArea = document.getElementById('previewArea');
                    const fileItems = Array.from(previewArea.getElementsByClassName('file-item'));
                    fileItems.forEach(item => {
                        if (item.querySelector('span').textContent === fileName) {
                            previewArea.removeChild(item);
                        }
                    });
                } catch (error) {
                    console.error("Error deleting file:", error);
                    alert(`Failed to delete ${fileName}`);
                }
            }
        }
    </script>
</body>
</html>
